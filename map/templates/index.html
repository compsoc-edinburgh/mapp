{% extends "base.html" %}

{% block title %}Welcome{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-12">
            <h2>
              <span id="maintitle">{{ room.name }}</span>
              <span class="pull-right">
                <a class="btn btn-primary btn-sm" id="reservemachine">Leave Me Alone</a>
              </span>
            </h2>
        </div>
    </div>
    <br>
    <div class="tabwrap">
      <table class="table">
        {% for row in rows %}
        <tr>
          {% for cell in row %}
          <td>
            {% if cell.hostname %}
            {% if cell.user or cell.hostname in reserved %}
            <p class="text-{% if current_user.has_friend(cell.user) %}info{% else %}danger{% endif %}" data-state="unavailable" id="status-{{ cell.hostname }}">
              {% if current_user.has_friend(cell.user) %}
              <i class="fa fa-star-o"></i>
              {% else %}
              <i class="fa fa-circle-thin"></i>
              {% endif %}
            </p>
            {% else %}
            <p class="text-success" data-state="available" id="status-{{ cell.hostname }}"><i class="fa fa-circle-thin"></i></p>
            {% endif %}
            <p class="hostname" id="host-{{ cell.hostname }}">{{ cell.hostname }}</p>
            {% if current_user.has_friend(cell.user) %}<p class="text-info"><small>{{ current_user.get_friend(cell.user) }}</small></p>{% endif %}
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </table>
    </div>
{% endblock %}

{% block scripts %}
  <script>
    $(document).ready(function () {
      $('#reservemachine').click(function () {
        $('.hostname').each(function () {
          $('#maintitle').text("Select a machine for us to consider 'Unavailable'");
          var hostname = $(this).html();
          var status = $('#status-' + hostname).data('state');
          console.log(hostname);
          console.log(status);

          if (status == "available") {
            $('#host-' + hostname).html("<a href='/reserve/" + hostname + "'>" + hostname +  "</a>");
          }
        });
      });
    });
  </script>
{% endblock %}
