{% extends "base.html" %}

{% block title %}Welcome{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-12">
            <h2>
              <span id="maintitle">{{ room.name }}</span>
              <span class="pull-right">
                <a class="btn btn-primary btn-sm" id="reservemachine">Leave Me Alone</a>
              </span>
            </h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table class="table table-bordered">
                {% for row in rows %}
                    <tr>
                        {% for cell in row %}
                            <td>
                                {% if cell.hostname %}
                                    <p class="hostname" id="host-{{ cell.hostname }}">{{ cell.hostname }}</p>
                                    {% if cell.user %}
                                        <p id="status-{{ cell.hostname }}" class="text-{% if current_user.has_friend(cell.user) %}info{% else %}danger{% endif %}">{% if current_user.has_friend(cell.user) %}{{ cell.user }}{% else %}Unavailable{% endif %}</p>
                                    {% else %}
                                        <p id="status-{{ cell.hostname }}" class="text-success">Available</p>
                                    {% endif %}
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
{% endblock %}

{% block scripts %}
  <script>
    $(document).ready(function () {
      $('#reservemachine').click(function () {
        $('.hostname').each(function () {
          $('#maintitle').text("Select a machine for us to consider 'Unavailable'");
          var hostname = $(this).html();
          var status = $('#status-' + hostname).text();

          if (status == "Available") {
            $('#host-' + hostname).html("<a href='/reserve/" + hostname + "'>" + hostname +  "</a>");
          }
        });
      });
    });
  </script>
{% endblock %}
